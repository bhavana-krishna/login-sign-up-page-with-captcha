<!DOCTYPE html>
<html>
<head>
  <title>Sign Up</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h2>Sign Up</h2>
    <input id="username" maxlength="30" placeholder="Gmail ID (example@gmail.com)">
    <input id="password" type="password" placeholder="Password">
    <div id="strengthText" style="font-size:0.9em;margin-bottom:10px;"></div>
    <div class="g-recaptcha" data-sitekey="6Lfoy-krAAAAAGBEwRr8I3-qxPj9CHHrIsoTQiBU"></div>
    <button onclick="register()">Register</button>

    <!-- Small box for Login -->
    <div style="display:flex; justify-content:center; align-items:center; margin-top:15px; gap:10px;">
      <span style="color:#fff;">Already have an account?</span>
      <div onclick="window.location.href='index.html'" style="
        padding:5px 10px;
        background: rgba(105, 104, 104, 0.43);
        color:#fff;
        border-radius:6px;
        cursor:pointer;
        font-size:0.9em;
        transition: all 0.3s ease;
        text-align:center;
      " onmouseover="this.style.background='rgba(255,255,255,0.35)'" 
        onmouseout="this.style.background='rgba(255,255,255,0.2)'">
        Login
      </div>
    </div>

    <p id="result" style="margin-top:10px;"></p>
  </div>
  
  <script>
    const passwordInput = document.getElementById("password");
    const strengthText = document.getElementById("strengthText");

    passwordInput.addEventListener("input", () => {
      const val = passwordInput.value;
      const strength = checkStrength(val);
      strengthText.textContent = strength.label;
      strengthText.style.color = strength.color;
    });

    function checkStrength(pw) {
      let score = 0;
      if (pw.length >= 8) score++;
      if (/[A-Z]/.test(pw)) score++;
      if (/[a-z]/.test(pw)) score++;
      if (/[0-9]/.test(pw)) score++;
      if (/[^A-Za-z0-9]/.test(pw)) score++;

      const levels = [
        { label: "Password Strength: Very Weak", color: "red" },
        { label: "Password Strength: Weak", color: "orange" },
        { label: "Password Strength: Average", color: "#ffd700" },
        { label: "Password Strength: Good", color: "lightgreen" },
        { label: "Password Strength: Strong", color: "#00ff7f" }
      ];
      return levels[Math.min(score, levels.length-1)];
    }

    function isValidGmail(username) {
      const regex = /^[a-zA-Z0-9._%+-]+@gmail\.com$/;
      return regex.test(username);
    }

    async function register() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const token = grecaptcha.getResponse();
      const result = document.getElementById("result");

      if (!username || !password) {
        result.style.color='red';
        result.innerText="All fields are required.";
        return;
      }

      if (!isValidGmail(username)) {
        result.style.color='red';
        result.innerText="Username must be a valid Gmail ID (example@gmail.com).";
        return;
      }

      if (!token) {
        result.style.color='red';
        result.innerText="Please complete CAPTCHA.";
        return;
      }

      const res = await fetch("/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password, token })
      });

      const data = await res.json();
      result.style.color = data.success ? "lightgreen" : "red";
      result.innerText = data.message;
      if(data.success) setTimeout(()=>window.location.href='index.html',2000);
    }
  </script>

  <!-- Galaxy stars JS -->
  <script>
    const body=document.body;
    for(let i=0;i<150;i++){
      const star=document.createElement('div');
      star.className='star';
      star.style.top=Math.random()*100+'vh';
      star.style.left=Math.random()*100+'vw';
      star.style.width=star.style.height=Math.random()*2+1+'px';
      star.style.animationDuration=(Math.random()*2+1)+'s';
      body.appendChild(star);
    }
  </script>

  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</body>
</html>
